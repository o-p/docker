server {
  server_name web-server.docker;
  charset utf-8;

  # Logs
  error_log  /kkcorp/logs/nginx/error.log;
  access_log /kkcorp/logs/nginx/access.log;

  root /app/public;
  index index.php index.html;

  # 直接回應靜態檔案
	location ~* \.(jpg|jpeg|gif|css|png|js|ico|html)$ {
		access_log off;
		expires max;
		log_not_found off;
	}

  # 如果非目錄, 自動砍掉尾端 /, 避免 SEO 有重複的內容 (但自己玩用不到)
	if (!-d $request_filename)
	{
		rewrite ^/(.+)/$ /$1 permanent;
	}

  # 導向 Laravel route
  location / {
		try_files $uri $uri/ /index.php?$query_string;
	}

  # PHP 透過 php-fpm service interpretation
  location ~* \.php$ {
      try_files $uri =404;
      fastcgi_split_path_info ^(.+\.php)(/.+)$;
      fastcgi_pass php:9000;
      fastcgi_index index.php;
      include fastcgi_params;
      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
      fastcgi_param PATH_INFO $fastcgi_path_info;
  }

  # 資安
  location ~ /\.ht {
    deny all;
  }

}
